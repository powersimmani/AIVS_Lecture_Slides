<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAM - Sharpness Aware Minimization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Aptos, 'Segoe UI', sans-serif; background: #FFFFFF; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 960px; height: 540px; padding: 25px 35px; display: flex; flex-direction: column; }
        .title-section { text-align: center; margin-bottom: 12px; }
        .main-title { font-size: 26px; font-weight: 600; color: #1E64C8; margin-bottom: 4px; }
        .subtitle { font-size: 14px; color: #666; }
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; flex: 1; }
        .card { background: white; border: 2.5px solid #1E64C8; border-radius: 12px; padding: 14px; display: flex; flex-direction: column; }
        .card.concept { border-color: #9C27B0; }
        .card.practice { border-color: #4CAF50; }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 10px; }
        .concept .card-title { color: #9C27B0; }
        .practice .card-title { color: #4CAF50; }
        .idea-box { background: #F3E5F5; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .idea-title { font-size: 12px; font-weight: 700; color: #7B1FA2; margin-bottom: 6px; }
        .idea-content { font-size: 11px; color: #333; line-height: 1.5; }
        .formula-box { background: #f8f8f8; border-radius: 8px; padding: 10px; margin-bottom: 10px; text-align: center; }
        .formula-main { font-family: 'Times New Roman', serif; font-size: 13px; color: #333; margin-bottom: 6px; }
        .formula-note { font-size: 10px; color: #666; }
        .visual-box { background: #f8f8f8; border-radius: 8px; padding: 10px; margin-bottom: 10px; text-align: center; }
        .code-box { background: #2d2d2d; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .code-content { font-family: 'Courier New', monospace; font-size: 9px; color: #d4d4d4; line-height: 1.4; }
        .code-comment { color: #6a9955; }
        .benefit-box { background: #E8F5E9; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .benefit-title { font-size: 12px; font-weight: 700; color: #2E7D32; margin-bottom: 6px; }
        .benefit-item { font-size: 11px; color: #333; margin-bottom: 4px; }
        .note-box { background: #FFF3E0; border-radius: 8px; padding: 10px; margin-top: auto; }
        .note-title { font-size: 12px; font-weight: 700; color: #E65100; margin-bottom: 6px; }
        .note-content { font-size: 11px; color: #333; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-section">
            <div class="main-title">SAM: Sharpness-Aware Minimization</div>
            <div class="subtitle">Finding flat minima for better generalization (Foret et al., 2021)</div>
        </div>
        <div class="content-grid">
            <div class="card concept">
                <div class="card-title">Core Concept</div>
                <div class="idea-box">
                    <div class="idea-title">Key Insight</div>
                    <div class="idea-content">
                        <strong>Flat minima generalize better than sharp minima.</strong><br><br>
                        Sharp minimum: Small weight perturbation -> large loss increase<br>
                        Flat minimum: Robust to weight perturbations
                    </div>
                </div>
                <div class="visual-box">
                    <svg viewBox="0 0 280 100" style="width: 100%; height: 90px;">
                        <!-- Sharp minimum -->
                        <path d="M20,80 Q50,80 60,20 Q70,80 100,80" fill="none" stroke="#F44336" stroke-width="2"/>
                        <circle cx="60" cy="20" r="4" fill="#F44336"/>
                        <text x="60" y="95" text-anchor="middle" font-size="9" fill="#C62828">Sharp (Bad)</text>
                        <!-- Flat minimum -->
                        <path d="M160,80 Q180,40 210,35 Q240,40 260,80" fill="none" stroke="#4CAF50" stroke-width="2"/>
                        <circle cx="210" cy="35" r="4" fill="#4CAF50"/>
                        <text x="210" y="95" text-anchor="middle" font-size="9" fill="#2E7D32">Flat (Good)</text>
                        <!-- Y-axis label -->
                        <text x="10" y="50" font-size="8" fill="#666">Loss</text>
                    </svg>
                </div>
                <div class="formula-box">
                    <div class="formula-main">min<sub>w</sub> max<sub>||epsilon||≤rho</sub> L(w + epsilon)</div>
                    <div class="formula-note">Find weights where loss stays low even when perturbed</div>
                </div>
                <div class="formula-box">
                    <div class="formula-main">epsilon* ≈ rho * grad L(w) / ||grad L(w)||</div>
                    <div class="formula-note">Approximate worst-case perturbation direction</div>
                </div>
            </div>
            <div class="card practice">
                <div class="card-title">Implementation</div>
                <div class="code-box">
                    <div class="code-content">
                        <span class="code-comment"># PyTorch SAM Implementation</span><br>
                        class SAM(torch.optim.Optimizer):<br>
                        &nbsp;&nbsp;def __init__(self, params, base_optimizer, rho=0.05):<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;self.base_optimizer = base_optimizer<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;self.rho = rho<br><br>
                        &nbsp;&nbsp;@torch.no_grad()<br>
                        &nbsp;&nbsp;def first_step(self):<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># Compute epsilon and perturb weights</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;grad_norm = self._grad_norm()<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;for p in self.param_groups[0]['params']:<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eps = self.rho * p.grad / grad_norm<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.add_(eps)  <span class="code-comment"># w + epsilon</span><br><br>
                        &nbsp;&nbsp;@torch.no_grad()<br>
                        &nbsp;&nbsp;def second_step(self):<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"># Restore and update</span><br>
                        &nbsp;&nbsp;&nbsp;&nbsp;self.base_optimizer.step()
                    </div>
                </div>
                <div class="benefit-box">
                    <div class="benefit-title">Benefits</div>
                    <div class="benefit-item">+ Better generalization (1-2% accuracy gain)</div>
                    <div class="benefit-item">+ More robust to label noise</div>
                    <div class="benefit-item">+ Works with any base optimizer (SGD, Adam)</div>
                    <div class="benefit-item">+ Simple to implement</div>
                </div>
                <div class="note-box">
                    <div class="note-title">Trade-offs</div>
                    <div class="note-content">
                        - <strong>2x compute:</strong> Two forward/backward passes per step<br>
                        - <strong>Hyperparameter:</strong> rho typically 0.01-0.1<br>
                        - <strong>Best for:</strong> When you have compute budget and need robustness
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
