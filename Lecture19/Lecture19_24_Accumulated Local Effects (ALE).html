<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accumulated Local Effects (ALE)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Aptos, 'Segoe UI', sans-serif;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            width: 960px;
            min-height: 540px;
            position: relative;
            background: white;
            padding: 25px 35px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }
        
        /* Main content */
        .content {
            display: flex;
            gap: 20px;
        }
        
        /* Comparison plots */
        .plots-section {
            flex: 1.6;
            display: flex;
            gap: 18px;
        }
        
        .plot-container {
            flex: 1;
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }
        
        .plot-container:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .plot-container.biased {
            border-color: #E57373;
        }
        
        .plot-container.unbiased {
            border-color: #4CAF50;
        }
        
        .plot-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 2px solid currentColor;
        }
        
        .plot-container.biased .plot-header {
            border-color: #E57373;
        }
        
        .plot-container.unbiased .plot-header {
            border-color: #4CAF50;
        }
        
        .plot-icon {
            font-size: 22px;
        }
        
        .plot-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .plot-container.biased .plot-title {
            color: #C62828;
        }
        
        .plot-container.unbiased .plot-title {
            color: #2E7D32;
        }
        
        .plot-canvas {
            flex: 1;
            background: #FAFAFA;
            border-radius: 8px;
            padding: 18px;
            position: relative;
            min-height: 220px;
        }
        
        svg {
            width: 100%;
            height: 100%;
        }
        
        .axis {
            stroke: #666;
            stroke-width: 2;
        }
        
        .axis-label {
            font-size: 13px;
            fill: #666;
            font-weight: 600;
        }
        
        .grid-line {
            stroke: #E5E7EB;
            stroke-width: 1;
        }
        
        /* PDP curve - biased */
        .pdp-curve {
            fill: none;
            stroke: #E57373;
            stroke-width: 3.5;
            stroke-dasharray: 5,5;
        }
        
        /* ALE curve - unbiased */
        .ale-curve {
            fill: none;
            stroke: #4CAF50;
            stroke-width: 3.5;
        }
        
        /* True effect (reference) */
        .true-curve {
            fill: none;
            stroke: #999;
            stroke-width: 2.5;
            stroke-dasharray: 3,3;
            opacity: 0.6;
        }
        
        .plot-note {
            margin-top: 12px;
            padding: 9px;
            border-radius: 6px;
            font-size: 13px;
            text-align: center;
            font-weight: 600;
        }
        
        .plot-container.biased .plot-note {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .plot-container.unbiased .plot-note {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        /* Info section */
        .info-section {
            flex: 0.5;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 4px;
        }
        
        .advantages-box {
            background: linear-gradient(135deg, #F0F7FF 0%, #E5F1FF 100%);
            border: 2px solid #1E64C8;
            border-radius: 10px;
            padding: 16px;
        }
        
        .advantages-title {
            font-size: 16px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 10px;
        }
        
        .advantage-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #333;
            line-height: 1.4;
        }
        
        .advantage-icon {
            color: #4CAF50;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .info-card {
            background: #F8FAFC;
            border-left: 4px solid #1E64C8;
            border-radius: 8px;
            padding: 12px 14px;
        }
        
        .info-title {
            font-weight: 700;
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .info-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        /* Comparison table */
        .comparison-table {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 12px;
        }
        
        .table-title {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .table-row {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        .table-label {
            flex: 1;
            font-weight: 600;
            color: #666;
        }
        
        .table-cell {
            flex: 1;
            text-align: center;
            padding: 4px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .cell-bad {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .cell-good {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        /* Legend */
        .legend {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 10px;
            background: #FAFAFA;
            border-radius: 6px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .legend-line {
            width: 35px;
            height: 3px;
            border-radius: 2px;
        }
        
        .legend-pdp {
            background: #E57373;
        }
        
        .legend-ale {
            background: #4CAF50;
        }
        
        .legend-true {
            background: #999;
        }

        /* How it Works Section */
        .how-it-works {
            border-top: 3px solid #1E64C8;
            padding-top: 25px;
        }

        .how-title {
            font-size: 22px;
            font-weight: 700;
            color: #1E64C8;
            margin-bottom: 20px;
            text-align: center;
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
        }

        .step-card {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s;
        }

        .step-card:hover {
            box-shadow: 0 4px 12px rgba(30, 100, 200, 0.15);
            transform: translateY(-2px);
            border-color: #1E64C8;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E5E7EB;
        }

        .step-number {
            background: linear-gradient(135deg, #1E64C8, #3B82F6);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
        }

        .step-content {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .step-formula {
            background: #F8FAFC;
            border-left: 3px solid #1E64C8;
            padding: 10px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            margin-top: 10px;
        }

        .step-visual {
            background: #FAFAFA;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            text-align: center;
        }

        .step-visual svg {
            max-height: 80px;
        }

        .key-point {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFF3CD 100%);
            border: 2px solid #FFA726;
            border-radius: 10px;
            padding: 16px;
            margin-top: 18px;
        }

        .key-point-title {
            font-size: 15px;
            font-weight: 700;
            color: #E65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .key-point-content {
            font-size: 13px;
            color: #333;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title">Accumulated Local Effects (ALE)</div>
            <div class="subtitle">Unbiased Feature Effects with Correlated Features</div>
        </div>
        
        <!-- Main Content -->
        <div class="content">
            <!-- Plots Section -->
            <div class="plots-section">
                <!-- PDP Plot -->
                <div class="plot-container biased">
                    <div class="plot-header">
                        <span class="plot-icon">‚ö†Ô∏è</span>
                        <div class="plot-title">PDP (Biased)</div>
                    </div>
                    
                    <div class="plot-canvas">
                        <svg viewBox="0 0 220 200">
                            <!-- Axes -->
                            <line x1="30" y1="170" x2="200" y2="170" class="axis"/>
                            <line x1="30" y1="20" x2="30" y2="170" class="axis"/>
                            
                            <!-- Grid lines -->
                            <line x1="30" y1="60" x2="200" y2="60" class="grid-line"/>
                            <line x1="30" y1="100" x2="200" y2="100" class="grid-line"/>
                            <line x1="30" y1="140" x2="200" y2="140" class="grid-line"/>
                            
                            <!-- True effect (reference) -->
                            <path d="M 30 155 Q 70 140 115 105 T 200 60" 
                                  class="true-curve"/>
                            
                            <!-- PDP curve - shows bias with wavy pattern -->
                            <path d="M 30 150 Q 60 130 80 95 Q 100 60 120 80 Q 140 100 160 75 Q 180 55 200 45" 
                                  class="pdp-curve"/>
                            
                            <!-- Axis labels -->
                            <text x="115" y="190" class="axis-label" text-anchor="middle">Feature X‚ÇÅ</text>
                            <text x="15" y="95" class="axis-label" text-anchor="middle" transform="rotate(-90 15 95)">Effect</text>
                        </svg>
                    </div>
                    
                    <div class="plot-note">
                        Extrapolates to unlikely regions
                    </div>
                </div>
                
                <!-- ALE Plot -->
                <div class="plot-container unbiased">
                    <div class="plot-header">
                        <span class="plot-icon">‚úì</span>
                        <div class="plot-title">ALE (Unbiased)</div>
                    </div>
                    
                    <div class="plot-canvas">
                        <svg viewBox="0 0 220 200">
                            <!-- Axes -->
                            <line x1="30" y1="170" x2="200" y2="170" class="axis"/>
                            <line x1="30" y1="20" x2="30" y2="170" class="axis"/>
                            
                            <!-- Grid lines -->
                            <line x1="30" y1="60" x2="200" y2="60" class="grid-line"/>
                            <line x1="30" y1="100" x2="200" y2="100" class="grid-line"/>
                            <line x1="30" y1="140" x2="200" y2="140" class="grid-line"/>
                            
                            <!-- True effect (reference) -->
                            <path d="M 30 155 Q 70 140 115 105 T 200 60" 
                                  class="true-curve"/>
                            
                            <!-- ALE curve - closely follows true effect -->
                            <path d="M 30 153 Q 70 138 115 103 T 200 57" 
                                  class="ale-curve"/>
                            
                            <!-- Axis labels -->
                            <text x="115" y="190" class="axis-label" text-anchor="middle">Feature X‚ÇÅ</text>
                            <text x="15" y="95" class="axis-label" text-anchor="middle" transform="rotate(-90 15 95)">Effect</text>
                        </svg>
                    </div>
                    
                    <div class="plot-note">
                        Stays in local neighborhoods
                    </div>
                </div>
            </div>
            
            <!-- Info Section -->
            <div class="info-section">
                <div class="section-title">Key Features</div>
                
                <div class="advantages-box">
                    <div class="advantages-title">ALE Advantages</div>
                    <div class="advantage-item">
                        <span class="advantage-icon">‚úì</span>
                        <span>Unbiased with correlated features</span>
                    </div>
                    <div class="advantage-item">
                        <span class="advantage-icon">‚úì</span>
                        <span>Local neighborhoods only</span>
                    </div>
                    <div class="advantage-item">
                        <span class="advantage-icon">‚úì</span>
                        <span>Computationally efficient</span>
                    </div>
                    <div class="advantage-item">
                        <span class="advantage-icon">‚úì</span>
                        <span>No marginalization needed</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-title">Local Effects</div>
                    <div class="info-desc">Accumulated across feature range</div>
                </div>
                
                <div class="info-card">
                    <div class="info-title">Reliability</div>
                    <div class="info-desc">More trustworthy for realistic datasets</div>
                </div>
                
                <div class="info-card">
                    <div class="info-title">Implementation</div>
                    <div class="info-desc">ALEPython package</div>
                </div>
                
                <!-- Comparison Table -->
                <div class="comparison-table">
                    <div class="table-title">Quick Comparison</div>
                    <div class="table-row">
                        <div class="table-label"></div>
                        <div class="table-cell" style="font-weight: 700; background: #F5F5F5;">PDP</div>
                        <div class="table-cell" style="font-weight: 700; background: #F5F5F5;">ALE</div>
                    </div>
                    <div class="table-row">
                        <div class="table-label">Correlated</div>
                        <div class="table-cell cell-bad">Biased</div>
                        <div class="table-cell cell-good">Unbiased</div>
                    </div>
                    <div class="table-row">
                        <div class="table-label">Speed</div>
                        <div class="table-cell cell-bad">Slow</div>
                        <div class="table-cell cell-good">Fast</div>
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-line legend-pdp"></div>
                        <span>PDP (Biased)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line legend-ale"></div>
                        <span>ALE (Unbiased)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line legend-true"></div>
                        <span>True Effect</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="how-it-works">
            <div class="how-title">üîç How ALE Works: Step-by-Step</div>
            
            <div class="steps-container">
                <!-- Step 1 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">Divide Feature Range</div>
                    </div>
                    <div class="step-content">
                        Divide the range of feature X into multiple small intervals. Each interval is limited only to regions where data actually exists.
                    </div>
                    <div class="step-visual">
                        <svg viewBox="0 0 200 50">
                            <line x1="20" y1="25" x2="180" y2="25" stroke="#666" stroke-width="2"/>
                            <line x1="20" y1="20" x2="20" y2="30" stroke="#666" stroke-width="2"/>
                            <line x1="60" y1="20" x2="60" y2="30" stroke="#1E64C8" stroke-width="2"/>
                            <line x1="100" y1="20" x2="100" y2="30" stroke="#1E64C8" stroke-width="2"/>
                            <line x1="140" y1="20" x2="140" y2="30" stroke="#1E64C8" stroke-width="2"/>
                            <line x1="180" y1="20" x2="180" y2="30" stroke="#666" stroke-width="2"/>
                            <text x="100" y="45" font-size="10" fill="#666" text-anchor="middle">Intervals</text>
                        </svg>
                    </div>
                    <div class="step-formula">
                        z‚ÇÅ, z‚ÇÇ, ..., z_k (k intervals)
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">Compute Local Differences</div>
                    </div>
                    <div class="step-content">
                        Calculate the difference in predictions when the feature value changes slightly within each interval. This represents the "local effect" of that interval.
                    </div>
                    <div class="step-formula">
                        Œî‚±º = f(z_{j+1}, X_{-j}) - f(z_j, X_{-j})
                        <br/>
                        <span style="font-size: 10px; color: #666;">Average over all data points in each interval</span>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">Average Within Interval</div>
                    </div>
                    <div class="step-content">
                        Average the local effects of all data points within each interval. This cancels out the effects of other features.
                    </div>
                    <div class="step-formula">
                        ALE_j = (1/n_j) Œ£ [f(z_{j+1}, X_i) - f(z_j, X_i)]
                        <br/>
                        <span style="font-size: 10px; color: #666;">n_j: number of data points in interval j</span>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-title">Accumulate Effects</div>
                    </div>
                    <div class="step-content">
                        Starting from the first interval, accumulate the local effects of each interval. This is what "Accumulated" in Accumulated Local Effects means.
                    </div>
                    <div class="step-formula">
                        ALE(z) = Œ£(j=1 to k) ALE_j
                        <br/>
                        <span style="font-size: 10px; color: #666;">Cumulative from left to right</span>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-title">Center the Plot</div>
                    </div>
                    <div class="step-content">
                        Center the entire ALE plot so the average is 0. This allows us to see the relative effect of the feature rather than its absolute effect.
                    </div>
                    <div class="step-formula">
                        ALE_centered(z) = ALE(z) - E[ALE(z)]
                        <br/>
                        <span style="font-size: 10px; color: #666;">Interpretation: effect relative to average</span>
                    </div>
                </div>

                <!-- Step 6 -->
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-title">Visualize & Interpret</div>
                    </div>
                    <div class="step-content">
                        The final ALE plot shows the pure effect on model predictions at each feature value. An upward slope indicates positive effect, while a downward slope indicates negative effect.
                    </div>
                    <div class="step-visual">
                        <svg viewBox="0 0 200 60">
                            <line x1="20" y1="50" x2="180" y2="50" stroke="#666" stroke-width="1.5"/>
                            <line x1="20" y1="10" x2="20" y2="50" stroke="#666" stroke-width="1.5"/>
                            <path d="M 20 45 Q 60 40 100 25 T 180 15" fill="none" stroke="#4CAF50" stroke-width="3"/>
                            <text x="100" y="10" font-size="9" fill="#2E7D32" text-anchor="middle" font-weight="600">Positive Effect ‚Üí</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Key Point Box -->
            <div class="key-point">
                <div class="key-point-title">
                    üí° Key Takeaway
                </div>
                <div class="key-point-content">
                    ALE operates only within <strong>local regions where actual data exists</strong>, so it doesn't suffer from the bias caused by unrealistic data combinations like PDP does. 
                    Even when features are correlated, ALE measures pure effects while maintaining the natural distribution of other features by considering only small changes within each interval.
                </div>
            </div>
        </div>
    </div>
</body>
</html>